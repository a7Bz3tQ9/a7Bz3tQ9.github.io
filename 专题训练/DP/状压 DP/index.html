
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://a7Bz3tQ9.github.io/%E4%B8%93%E9%A2%98%E8%AE%AD%E7%BB%83/DP/%E7%8A%B6%E5%8E%8B%20DP/">
      
      
        <link rel="prev" href="../../%E5%9B%BE%E8%AE%BA/%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF/">
      
      
        <link rel="next" href="../%E6%A0%91%E5%BD%A2%20DP/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>状压 DP - notes</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Fira Sans";--md-code-font:"Fira Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dp" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="notes" class="md-header__button md-logo" aria-label="notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              状压 DP
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../%E6%AF%94%E8%B5%9B%E5%88%86%E6%9E%90/CSP-S%202025/" class="md-tabs__link">
          
  
  
  比赛分析

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../%E5%9B%BE%E8%AE%BA/%E5%9B%BE%E8%AE%BA/" class="md-tabs__link">
          
  
  
  专题训练

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="notes" class="md-nav__button md-logo" aria-label="notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    首页
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    比赛分析
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    比赛分析
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E6%AF%94%E8%B5%9B%E5%88%86%E6%9E%90/CSP-S%202025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSP-S 2025 分析
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    专题训练
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    专题训练
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    图论
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    图论
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E8%AE%BA/%E5%9B%BE%E8%AE%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最短路+最小生成树
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E7%9F%AD%E8%B7%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最短路
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E8%AE%BA/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最小生成树
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E8%AE%BA/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    拓扑排序
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../%E5%9B%BE%E8%AE%BA/%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    欧拉回路
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    DP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    状压 DP
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    状压 DP
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dp" class="md-nav__link">
    <span class="md-ellipsis">
      
        状压 DP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状压 DP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p1879-usaco06novcorn-fields-g" class="md-nav__link">
    <span class="md-ellipsis">
      
        P1879 [USACO06NOV]Corn Fields G
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topcoder14667-rainbowgraph" class="md-nav__link">
    <span class="md-ellipsis">
      
        TopCoder14667 RainbowGraph
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        小练习
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p3959-noip2017" class="md-nav__link">
    <span class="md-ellipsis">
      
        P3959 [NOIP2017 提高组] 宝藏
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arc058e-iroha-and-haiku" class="md-nav__link">
    <span class="md-ellipsis">
      
        [ARC058E] Iroha and Haiku
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p4363-2018-chess" class="md-nav__link">
    <span class="md-ellipsis">
      
        *P4363 [九省联考 2018] 一双木棋 chess
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cf743e-vladik-and-cards2200" class="md-nav__link">
    <span class="md-ellipsis">
      
        CF743E Vladik and cards（*2200）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cf599e-sandy-and-nuts2600" class="md-nav__link">
    <span class="md-ellipsis">
      
        *CF599E Sandy and Nuts（*2600）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bzoj-3864-hero-meet-devil" class="md-nav__link">
    <span class="md-ellipsis">
      
        BZOJ 3864 Hero meet devil
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdu-4352-xhxjs-lis" class="md-nav__link">
    <span class="md-ellipsis">
      
        HDU 4352 XHXJ's LIS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uoj549-unr-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        *UOJ#549. 【UNR #4】序列妙妙值
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p6192" class="md-nav__link">
    <span class="md-ellipsis">
      
        *P6192 【模板】最小斯坦纳树
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#at_apc001_f-xor-tree" class="md-nav__link">
    <span class="md-ellipsis">
      
        *AT_apc001_f XOR Tree
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%A0%91%E5%BD%A2%20DP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    树形 DP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%A0%91%E5%BD%A2%20DP%202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    树形 DP 2
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../DP%20%E4%BC%98%E5%8C%96/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DP 优化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dp" class="md-nav__link">
    <span class="md-ellipsis">
      
        状压 DP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="状压 DP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#p1879-usaco06novcorn-fields-g" class="md-nav__link">
    <span class="md-ellipsis">
      
        P1879 [USACO06NOV]Corn Fields G
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#topcoder14667-rainbowgraph" class="md-nav__link">
    <span class="md-ellipsis">
      
        TopCoder14667 RainbowGraph
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        小练习
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p3959-noip2017" class="md-nav__link">
    <span class="md-ellipsis">
      
        P3959 [NOIP2017 提高组] 宝藏
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arc058e-iroha-and-haiku" class="md-nav__link">
    <span class="md-ellipsis">
      
        [ARC058E] Iroha and Haiku
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p4363-2018-chess" class="md-nav__link">
    <span class="md-ellipsis">
      
        *P4363 [九省联考 2018] 一双木棋 chess
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cf743e-vladik-and-cards2200" class="md-nav__link">
    <span class="md-ellipsis">
      
        CF743E Vladik and cards（*2200）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cf599e-sandy-and-nuts2600" class="md-nav__link">
    <span class="md-ellipsis">
      
        *CF599E Sandy and Nuts（*2600）
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bzoj-3864-hero-meet-devil" class="md-nav__link">
    <span class="md-ellipsis">
      
        BZOJ 3864 Hero meet devil
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdu-4352-xhxjs-lis" class="md-nav__link">
    <span class="md-ellipsis">
      
        HDU 4352 XHXJ's LIS
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uoj549-unr-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        *UOJ#549. 【UNR #4】序列妙妙值
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#p6192" class="md-nav__link">
    <span class="md-ellipsis">
      
        *P6192 【模板】最小斯坦纳树
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#at_apc001_f-xor-tree" class="md-nav__link">
    <span class="md-ellipsis">
      
        *AT_apc001_f XOR Tree
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>状压 DP</h1>

<p><a href="https://www.cnblogs.com/maoyiting/p/13368682.html">1</a></p>
<h2 id="dp">状压 DP<a class="headerlink" href="#dp" title="Permanent link">&para;</a></h2>
<h5 id="p1879-usaco06novcorn-fields-g">P1879 [USACO06NOV]Corn Fields G<a class="headerlink" href="#p1879-usaco06novcorn-fields-g" title="Permanent link">&para;</a></h5>
<blockquote>
<p><span class="arithmatex">\(m\)</span> 行 <span class="arithmatex">\(n\)</span> 列的网格，有几格不能种草，其余的相邻两个格子只有一个能种草，问合法的种草方案数。</p>
<p><span class="arithmatex">\(1\leq n,m\leq 12\)</span>。</p>
</blockquote>
<p>一个比较暴力的 DP 方式，将每个点的状态全部记录在 DP 状态里。</p>
<p>设 <span class="arithmatex">\(f_{i,S}\)</span> 表示考虑了前 <span class="arithmatex">\(i\)</span> 行，第 <span class="arithmatex">\(i\)</span> 行的种草状态为 <span class="arithmatex">\(S\)</span> 时的合法方案数。</p>
<p>转移时枚举第 <span class="arithmatex">\(i+1\)</span> 行的状态，判断合法则转移。时间复杂度 <span class="arithmatex">\(\mathcal O(m2^{2n})\)</span>。</p>
<h5 id="topcoder14667-rainbowgraph">TopCoder14667 RainbowGraph<a class="headerlink" href="#topcoder14667-rainbowgraph" title="Permanent link">&para;</a></h5>
<blockquote>
<p>给出一张 <span class="arithmatex">\(n\)</span> 个点 <span class="arithmatex">\(m\)</span> 条边的无向图，点有颜色 <span class="arithmatex">\(c_i\)</span>。</p>
<p>问有多少条路径，满足经过每个点恰好一次，且按顺序经过的点的颜色序列写下来同种颜色出现的位置连续。</p>
<p><span class="arithmatex">\(2\leq n\leq 100\)</span>，<span class="arithmatex">\(1\leq m\leq 2500\)</span>，<span class="arithmatex">\(0\leq c_i\leq 9\)</span>，<span class="arithmatex">\(\forall x,\sum_{i=1}^n[c_i=x]\leq 10\)</span>。</p>
</blockquote>
<p>将同种颜色的点串起来：枚举每种颜色 <span class="arithmatex">\(c\)</span>，设 <span class="arithmatex">\(f_{i,j,S}\)</span> 表示从颜色 <span class="arithmatex">\(c\)</span> 的第 <span class="arithmatex">\(i\)</span> 个点出发，走到颜色 <span class="arithmatex">\(c\)</span> 的第 <span class="arithmatex">\(j\)</span> 个点，经过的点的集合为 <span class="arithmatex">\(S\)</span> 的路径条数。</p>
<p>将所有颜色串起来：设 <span class="arithmatex">\(g_{i,S}\)</span> 表示以节点 <span class="arithmatex">\(i\)</span> 结尾，已经经过的颜色集合为 <span class="arithmatex">\(S\)</span> 的总方案数。转移枚举下一个点的颜色以及是哪个点。</p>
<h5 id="_1">小练习<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<blockquote>
<p><span class="arithmatex">\(n\)</span> 个物品，每个重量 <span class="arithmatex">\(w_i\)</span>，问至少需要多少大小为 <span class="arithmatex">\(S\)</span> 的麻袋才能将他们都装进来。</p>
<p><span class="arithmatex">\(n\leq 20\)</span>，<span class="arithmatex">\(w_i\leq 10^9\)</span>。</p>
</blockquote>
<p><span class="arithmatex">\(n\leq 20\)</span>：我们希望 DP 时每次只加一个元素。</p>
<p>考虑按某种顺序将物品排成一排，从左到右扫，当前麻袋还能装进去就装，否则新开一个麻袋。</p>
<p>状压，设 <span class="arithmatex">\(f_i\)</span> 表示装集合 <span class="arithmatex">\(i\)</span> 里的物品，最少要多少麻袋，以及当前最后一个麻袋装了多少重量。也就是记了一个 pair (mn,sum)。取 <span class="arithmatex">\(\min\)</span> 时，先让第一维尽可能小，再让第二维尽可能小。转移枚举一个不在 <span class="arithmatex">\(i\)</span> 中的物品，尝试将它装进最后一个麻袋，不行的话新开一个麻袋。这样就可以每次直接在末尾加一个数而不是枚举子集了。</p>
<p>最优方案已经会被算到。因为只要末尾加入数的顺序和上面所说的“某种顺序”一样，这个答案肯定会被统计。</p>
<h5 id="p3959-noip2017">P3959 [NOIP2017 提高组] 宝藏<a class="headerlink" href="#p3959-noip2017" title="Permanent link">&para;</a></h5>
<blockquote>
<p>给出一张 <span class="arithmatex">\(n\)</span> 个点 <span class="arithmatex">\(m\)</span> 条边的无向图，边有边权。你可以自己找一棵生成树，然后选定一个根，最小化每个点与其父亲的边权值 <span class="arithmatex">\(\times\)</span> 该点深度的总和。</p>
<p><span class="arithmatex">\(1\leq n\leq 12\)</span>，<span class="arithmatex">\(0\leq m\leq 10^3\)</span>。</p>
</blockquote>
<p>一个朴素的 DP：设 <span class="arithmatex">\(f_{S,S',d}\)</span> 表示当前树选了集合 <span class="arithmatex">\(S\)</span> 里的点，树上最下面一层的点是集合 <span class="arithmatex">\(S'\)</span>，最下面一层点的深度是 <span class="arithmatex">\(d\)</span>，最小总和是多少。转移枚举再下一层的点（深度为 <span class="arithmatex">\(d+1\)</span>）的集合 <span class="arithmatex">\(T\)</span>。无法通过。</p>
<p>实际上不需要记录 <span class="arithmatex">\(S'\)</span>，只需要让每个 <span class="arithmatex">\(T\)</span> 里的点与 <span class="arithmatex">\(S\)</span> 里的任意点有连边即可，而不是必须与最下面一层的 <span class="arithmatex">\(S'\)</span> 有连边。也就是说，无视 <span class="arithmatex">\(S'\)</span>，每次枚举新的一层当第 <span class="arithmatex">\(d+1\)</span> 层，不管连到什么点都当深度 <span class="arithmatex">\(d+1\)</span>。这样可能会把某些点的深度算大，但这样的方案不优，最优解一定会被我们统计。这样就能过了。</p>
<p>（技巧：放宽转移条件）</p>
<h5 id="arc058e-iroha-and-haiku">[ARC058E] Iroha and Haiku<a class="headerlink" href="#arc058e-iroha-and-haiku" title="Permanent link">&para;</a></h5>
<p>去掉 DP 状态中的“是否存在”的小技巧 + 思考 DP 的形式</p>
<blockquote>
<p>一个值域 <span class="arithmatex">\(\in[1,10]\)</span> 的序列 <span class="arithmatex">\(a_{1\sim n}\)</span> 是好的，当且仅当存在下标 <span class="arithmatex">\(x,y,z,w\,(0\leq x&lt;y&lt;z&lt;w\leq n)\)</span> 满足：</p>
<ul>
<li><span class="arithmatex">\(a_x+a_{x+1}+\cdots+a_{y-1}=X\)</span>。</li>
<li><span class="arithmatex">\(a_y+a_{y+1}+\cdots+a_{z-1}=Y\)</span>。</li>
<li><span class="arithmatex">\(a_z+a_{z+1}+\cdots+a_{w-1}=Z\)</span>。</li>
</ul>
<p>给出 <span class="arithmatex">\(n,X,Y,Z\)</span>，求好的序列的方案数 <span class="arithmatex">\(\bmod 10^9+7\)</span>。</p>
<p><span class="arithmatex">\(3\leq n\leq 40\)</span>，<span class="arithmatex">\(1\leq X,Z\leq 5\)</span>，<span class="arithmatex">\(1\leq Y\leq 7\)</span>。</p>
</blockquote>
<p>暴力的状态设计：</p>
<ul>
<li>由于 <span class="arithmatex">\(a_x+\cdots+a_{w-1}=X+Y+Z\leq 17\)</span>，考虑值域 <span class="arithmatex">\([1,10]\)</span> 且和 <span class="arithmatex">\(\leq 17\)</span> 的序列只有 <span class="arithmatex">\(130624\)</span> 个，DP 过程中每次只需保留最靠后的和 <span class="arithmatex">\(\leq 17\)</span> 的元素队列。</li>
</ul>
<p>设 <span class="arithmatex">\(f_{i,S,0/1}\)</span> 表示考虑了前 <span class="arithmatex">\(i\)</span> 个元素，队列的状态为 <span class="arithmatex">\(S\)</span>，是否出现题中所述条件的方案数。</p>
<p>优化 1：预处理每个状态是否满足题中所述条件。</p>
<p>优化 2：预处理出每个状态遇上 <span class="arithmatex">\(1\sim 10\)</span> 后分别转移到什么状态。</p>
<p>优化 3（小技巧）：通过求补集去掉状态中的第三维。即强制过程中必须不出现题中所述条件，用总方案数 <span class="arithmatex">\(10^n\)</span> 减去它。</p>
<p>优雅的状态设计：</p>
<ul>
<li>换个形式表示“和 <span class="arithmatex">\(\leq 17\)</span>”这个状态。</li>
</ul>
<p>把序列“展开”。将“<span class="arithmatex">\(X+Y+Z\)</span>”展开成一条长度为 <span class="arithmatex">\(X+Y+Z\)</span> 的格子，一个数可以占领 <span class="arithmatex">\(1\sim 10\)</span> 个格子，只需考虑位置在 <span class="arithmatex">\(X,X+Y,X+Y+Z\)</span> 的三个格子是否是一个数所占领格子的末尾。</p>
<p>将一个数的末尾标为 <span class="arithmatex">\(1\)</span>，其他格子标为 <span class="arithmatex">\(0\)</span>，状压。</p>
<h5 id="p4363-2018-chess">*P4363 [九省联考 2018] 一双木棋 chess<a class="headerlink" href="#p4363-2018-chess" title="Permanent link">&para;</a></h5>
<p><a href="https://www.cnblogs.com/LawrenceSivan/p/14918023.html">好评题解</a></p>
<blockquote>
<p>一个 <span class="arithmatex">\(n\times m\)</span> 的棋盘，两人轮流下棋，一个位置可以落子当且仅当这个位置的左侧和上面都落了子。两个人落在对应的位置会收货各自的贡献值 <span class="arithmatex">\(a_{i,j}\)</span> / <span class="arithmatex">\(b_{i,j}\)</span>，最大化自己的得分减去对方的得分。</p>
<p>求先手的这个最大值。</p>
<p><span class="arithmatex">\(1\leq n,m\leq 10\)</span>，<span class="arithmatex">\(0\leq a_{i,j},b_{i,j}\leq 10^5\)</span>。</p>
</blockquote>
<p>状压，如何存状态？由于落子是合法的需要满足左边和上边都有棋子，所以每行的棋子数从上往下递减，这样的轮廓一定是连续的。</p>
<p>考虑存储轮廓线作为状态。轮廓线长度肯定是 <span class="arithmatex">\(n+m\)</span> 的。从右上角开始，向左下角延伸，我们用 <span class="arithmatex">\(0\)</span> 表示横边，<span class="arithmatex">\(1\)</span> 表示竖边。</p>
<p><img src="https://img2022.cnblogs.com/blog/1859218/202207/1859218-20220724202618406-1341098821.png" alt="image" style="zoom: 33%;" /><img src="https://img2022.cnblogs.com/blog/1859218/202207/1859218-20220724202725030-1675224879.png" alt="image" style="zoom:33%;" /></p>
<p>比如上面那个这个，<span class="arithmatex">\(000101010101010101\)</span>。</p>
<p>发现落子相当于将串中的 <span class="arithmatex">\(01\)</span> 变为 <span class="arithmatex">\(10\)</span>。通过判 <code>((s&gt;&gt;i)&amp;3)==1</code> 来判 <span class="arithmatex">\(01\)</span>（<span class="arithmatex">\(3\)</span> 的二进制是 <span class="arithmatex">\(11\)</span>），落子后状态为 <code>s^(3&lt;&lt;i)</code>。起始状态 <span class="arithmatex">\(00\cdots 0011\cdots11\)</span>，终止状态 <span class="arithmatex">\(11\cdots1100\cdots00\)</span>。</p>
<p>设 <span class="arithmatex">\(f_S\)</span> 表示状态 <span class="arithmatex">\(S\)</span> 的最大得分差。但博弈论 DP 的题不能这样做，由于两方都采取最优策略，我们不得不考虑将来的行动对现在的影响。正序 DP 可能会发生当前确实取到了最大值，但是其实并不是最优策略。</p>
<p>于是考虑倒过来 DP。假装我们可以一步看到结局，然后选择对自己最有利的状态。设 <span class="arithmatex">\(f_S\)</span> 表示从状态 <span class="arithmatex">\(S\)</span> 到结束还能获得的最大得分差。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">];</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kt">bool</span><span class="w"> </span><span class="n">vis</span><span class="p">[</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">20</span><span class="p">];</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">dfs</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">o</span><span class="p">){</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">s</span><span class="p">])</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="n">vis</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">=</span><span class="mf">-1e9</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="mi">-1</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="k">if</span><span class="p">((</span><span class="n">s</span><span class="o">&gt;&gt;</span><span class="n">i</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">))</span><span class="w"> </span><span class="n">x</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="n">y</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="k">if</span><span class="p">(((</span><span class="n">s</span><span class="o">&gt;&gt;</span><span class="n">i</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">],(</span><span class="o">!</span><span class="n">o</span><span class="o">?</span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">]</span><span class="o">:</span><span class="n">b</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">y</span><span class="p">])</span><span class="o">-</span><span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="o">^</span><span class="p">(</span><span class="mi">3</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">),</span><span class="n">o</span><span class="o">^</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="p">}</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="n">vis</span><span class="p">[((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">m</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">f</span><span class="p">[((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="p">)</span><span class="mi">-1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">m</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">dfs</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">n</span><span class="p">)</span><span class="mi">-1</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="p">}</span>
</code></pre></div>
<h5 id="cf743e-vladik-and-cards2200">CF743E Vladik and cards（*2200）<a class="headerlink" href="#cf743e-vladik-and-cards2200" title="Permanent link">&para;</a></h5>
<p>优化子序列相关 DP 的技巧</p>
<blockquote>
<p>给出 <span class="arithmatex">\(a_{1\sim n}\)</span>，值域 <span class="arithmatex">\([1,8]\)</span>。求一个最长的子序列，满足：<span class="arithmatex">\(1\sim 8\)</span> 每种取值的出现次数相差 <span class="arithmatex">\(\leq 1\)</span>，且每种取值出现在子序列中的位置连续。</p>
<p><span class="arithmatex">\(1\leq n\leq 1000\)</span>。</p>
</blockquote>
<p>DP 中处理“相差 <span class="arithmatex">\(\leq 1\)</span>”不太现实，考虑枚举出现次数 <span class="arithmatex">\(L\)</span>，表示每种数字的出现次数 <span class="arithmatex">\(\in\{L,L+1\}\)</span>。</p>
<p>设 <span class="arithmatex">\(f_{i,S}\)</span> 表示考虑了前 <span class="arithmatex">\(i\)</span> 位，已经处理好颜色集合 <span class="arithmatex">\(S\)</span> 的最长子序列长度。枚举下一个出现的颜色 <span class="arithmatex">\(c\)</span> 及其出现次数 <span class="arithmatex">\(l\in\{L,L+1\}\)</span>，肯定贪心取颜色 <span class="arithmatex">\(c\)</span> 最靠前的 <span class="arithmatex">\(l\)</span> 个，可以预处理 <span class="arithmatex">\(nxt_{i,c,k}\)</span> 表示 <span class="arithmatex">\(i\)</span> 后面第 <span class="arithmatex">\(k\)</span> 个颜色 <span class="arithmatex">\(c\)</span> 的位置。</p>
<p>优化 1：</p>
<ul>
<li>最优性：<span class="arithmatex">\(L\)</span> 越大越好，因为 <span class="arithmatex">\(\{L+1,L+2\}\)</span> 即使全取 <span class="arithmatex">\(L+1\)</span> 也不劣于 <span class="arithmatex">\(\{L,L+1\}\)</span> 全取 <span class="arithmatex">\(L+1\)</span>。我们只需找到最大的存在合法解的 <span class="arithmatex">\(L\)</span>，再最大化取 <span class="arithmatex">\(L+1\)</span> 的颜色数。</li>
<li>合法性：<span class="arithmatex">\(L\)</span> 的取值的合法性是单调的，可以把枚举 <span class="arithmatex">\(L\)</span> 改为二分。</li>
</ul>
<p>优化 2：</p>
<ul>
<li>新增转移 <span class="arithmatex">\(f_{i,S}\to f_{i+1,S}\)</span> 表示 <span class="arithmatex">\(i+1\)</span> 不选入子序列，然后不需要枚举 <span class="arithmatex">\(c\)</span> 直接钦定下一种颜色是 <span class="arithmatex">\(a_{i+1}\)</span> 表示 <span class="arithmatex">\(i+1\)</span> 选入子序列。实际上是将状态中“以 <span class="arithmatex">\(i\)</span> 结尾”换成了“前 <span class="arithmatex">\(i\)</span> 位”。</li>
</ul>
<p><span class="arithmatex">\(nxt_{i,c,k}\)</span> 的 <span class="arithmatex">\(c\)</span> 也可以去掉，直接 <span class="arithmatex">\(nxt_{i,k}\)</span> 表示 <span class="arithmatex">\(i\)</span> 后面第 <span class="arithmatex">\(k\)</span> 个颜色 <span class="arithmatex">\(a_i\)</span> 的位置。</p>
<h5 id="cf599e-sandy-and-nuts2600">*CF599E Sandy and Nuts（*2600）<a class="headerlink" href="#cf599e-sandy-and-nuts2600" title="Permanent link">&para;</a></h5>
<blockquote>
<p>一棵 <span class="arithmatex">\(n\)</span> 个节点的树，根为 <span class="arithmatex">\(1\)</span>，你知道 <span class="arithmatex">\(m\)</span> 条信息：</p>
<ul>
<li>某些树上的边。</li>
<li>某两个点的 <span class="arithmatex">\(\text{lca}\)</span>。</li>
</ul>
<p>求满足条件的树的个数。</p>
<p><span class="arithmatex">\(1\leq n\leq 13\)</span>，<span class="arithmatex">\(0\leq m\leq 100\)</span>。</p>
</blockquote>
<p>设 <span class="arithmatex">\(f_{x,S}\)</span> 表示以 <span class="arithmatex">\(x\)</span> 为根的子树中，点集为 <span class="arithmatex">\(S\)</span> 的合法方案数。</p>
<p>如果不考虑 <span class="arithmatex">\(m\)</span> 条限制 <span class="arithmatex">\(f_{x,S}'\gets f_{x,S-T}\times f_{y,T}\,(x\notin T,y\in T)\)</span>。</p>
<p>考虑上限制就把那些不合法的中途舍掉（不转移）即可。</p>
<p>比如边 <span class="arithmatex">\((x,y)\)</span> 的约束，要么 <span class="arithmatex">\(y\)</span> 是 <span class="arithmatex">\(x\)</span> 的儿子要么 <span class="arithmatex">\(y\)</span> 是 <span class="arithmatex">\(x\)</span> 的父亲，在 DP <span class="arithmatex">\(x\)</span> 时只处理前一种情况（若 <span class="arithmatex">\(y\subseteq T\)</span> 但 <span class="arithmatex">\(y\)</span> 不是根就舍掉），在 DP <span class="arithmatex">\(fa_x\)</span> 时处理后一种情况。</p>
<p><span class="arithmatex">\(\text{lca}(x,y)=z\)</span> 的限制，在 DP <span class="arithmatex">\(z\)</span> 时处理，若 <span class="arithmatex">\(x\in T\land y\in T\)</span> 就舍掉，若最后 <span class="arithmatex">\(x\not\in S\lor y\not\in S\)</span> 就舍掉。</p>
<h5 id="bzoj-3864-hero-meet-devil">BZOJ 3864 Hero meet devil<a class="headerlink" href="#bzoj-3864-hero-meet-devil" title="Permanent link">&para;</a></h5>
<p>DP 套 DP，状压 DP 状态</p>
<blockquote>
<p>给出一个长度为 <span class="arithmatex">\(n\)</span> 的字符串 <span class="arithmatex">\(s\)</span>，对于每个 <span class="arithmatex">\(k\in[0,n]\)</span>，求有多少长度为 <span class="arithmatex">\(m\)</span> 的字符串 <span class="arithmatex">\(t\)</span> 满足 <span class="arithmatex">\(\text{lcs}(s,t)=k\)</span>。</p>
<p><span class="arithmatex">\(n\leq 15\)</span>，字符集大小为 <span class="arithmatex">\(4\)</span>。</p>
</blockquote>
<p>考虑求 LCS 的过程：设 <span class="arithmatex">\(f_{i,j}\)</span> 表示 <span class="arithmatex">\(t\)</span> 的前 <span class="arithmatex">\(i\)</span> 位和 <span class="arithmatex">\(s\)</span> 的前 <span class="arithmatex">\(j\)</span> 位的 LCS。</p>
<p>设 <span class="arithmatex">\(g_{i,S}\)</span> 表示考虑了 <span class="arithmatex">\(t\)</span> 的前 <span class="arithmatex">\(i\)</span> 位，DP 数组 <span class="arithmatex">\(f_i\)</span> 是 <span class="arithmatex">\(S\)</span> 的方案数。</p>
<p>注意到 <span class="arithmatex">\(f_{i,j-1}\leq f_{i,j}\leq f_{i,j-1}+1\)</span>，即 <span class="arithmatex">\(f_{i,j}-f_{i,j-1}\in\{0,1\}\)</span>，状压差分数组：<span class="arithmatex">\(S\)</span> 中只要记录相邻两项的差值，不是 <span class="arithmatex">\(0\)</span> 就是 <span class="arithmatex">\(1\)</span>。</p>
<p>转移枚举字符是什么，可以预处理做到 <span class="arithmatex">\(\mathcal O(1)\)</span> 转移。时间复杂度 <span class="arithmatex">\(\mathcal O(m2^n)\)</span>。</p>
<p>扩展：由于每一步转移都是一样的，可以矩阵快速幂优化。</p>
<h5 id="hdu-4352-xhxjs-lis">HDU 4352 XHXJ's LIS<a class="headerlink" href="#hdu-4352-xhxjs-lis" title="Permanent link">&para;</a></h5>
<blockquote>
<p>给出 <span class="arithmatex">\(l,r\)</span>，其有多少 <span class="arithmatex">\(x\in[l,r]\)</span>，使得将 <span class="arithmatex">\(x\)</span> 看成字符串，其 LIS 恰好为 <span class="arithmatex">\(k\)</span>。</p>
<p><span class="arithmatex">\(T\leq 10^4\)</span>，<span class="arithmatex">\(0&lt;l\leq r&lt;2^{63}-1\)</span>，<span class="arithmatex">\(1\leq k\leq 10\)</span>。</p>
</blockquote>
<p>先按数位 DP 的套路：<code>calc(r)-calc(l-1)</code> 去掉下界，然后设 <span class="arithmatex">\(f_{i,S,0/1}\)</span> 表示处理到从高到低的第 <span class="arithmatex">\(i\)</span> 位，LIS 状态为 <span class="arithmatex">\(S\)</span>，是否顶到上界的方案数。转移枚举第 <span class="arithmatex">\(i+1\)</span> 位的数字。</p>
<p>怎么定义 <span class="arithmatex">\(S\)</span>？考虑二分求 LIS 的过程：设 <span class="arithmatex">\(f_i\)</span> 表示长度为 <span class="arithmatex">\(i\)</span> 的 LIS 中末位元素的最小值。二分出最大的 <span class="arithmatex">\(f_j&lt;a_i\)</span>，<span class="arithmatex">\(f_{j+1}\gets a_i\)</span>。考虑压缩 <span class="arithmatex">\(f\)</span> 数组！</p>
<p>在本题中，<span class="arithmatex">\(f_i\in[0,9]\)</span>，且元素个数至多为 <span class="arithmatex">\(10\)</span>，但显然不能 <span class="arithmatex">\(10^{10}\)</span> 个状态。发现 <span class="arithmatex">\(f_i\)</span> 严格单调递增，爆搜出所有合法的状态？只需要记录 <span class="arithmatex">\(0\sim 9\)</span> 每个数字是否在 <span class="arithmatex">\(f_i\)</span> 出现即可，<span class="arithmatex">\(2^{10}\)</span>。</p>
<h5 id="uoj549-unr-4">*UOJ#549. 【UNR #4】序列妙妙值<a class="headerlink" href="#uoj549-unr-4" title="Permanent link">&para;</a></h5>
<blockquote>
<p>给出一个长度为 <span class="arithmatex">\(n\)</span> 的序列 <span class="arithmatex">\(a\)</span>，对 <span class="arithmatex">\(a\)</span> 的每个前缀，求将其划分为 <span class="arithmatex">\(k\)</span> 段，每段异或和之和的最小值是多少。</p>
<p><span class="arithmatex">\(1\leq k\leq n\leq 6\times 10^4\)</span>，<span class="arithmatex">\(k\leq 8\)</span>，<span class="arithmatex">\(a_i&lt;2^{16}\)</span>。</p>
</blockquote>
<p>求出 <span class="arithmatex">\(a_i\)</span> 的前缀异或和 <span class="arithmatex">\(s_i\)</span>。设 <span class="arithmatex">\(f_{i,k}\)</span> 表示前 <span class="arithmatex">\(i\)</span> 个数分成 <span class="arithmatex">\(k\)</span> 段的最小值，<span class="arithmatex">\(f_{i,k}=\min\{f_{j,k-1}+s_i\oplus s_j\}\)</span>。时间复杂度 <span class="arithmatex">\(\mathcal O(n^2k)\)</span>。</p>
<p>当值域较小时，记 <span class="arithmatex">\(g_v\)</span> 表示 <span class="arithmatex">\(s_j=v\)</span> 的最小的 <span class="arithmatex">\(f_{j,k-1}\)</span>，复杂度 <span class="arithmatex">\(\mathcal O(nkv)\)</span>。</p>
<p>值域较大时，查询枚举 <span class="arithmatex">\(v\)</span> 复杂度过大，考虑在修改时处理出。</p>
<p>固定 <span class="arithmatex">\(k\)</span>。考虑 <span class="arithmatex">\(j\)</span> 对后面 <span class="arithmatex">\(i\)</span> 的贡献，设 <span class="arithmatex">\(g_{x,y}\)</span> 表示 <span class="arithmatex">\(s_j\)</span> 的前 <span class="arithmatex">\(8\)</span> 位是 <span class="arithmatex">\(x\)</span>，<span class="arithmatex">\(s_i\)</span> 的后 <span class="arithmatex">\(8\)</span> 位是 <span class="arithmatex">\(y\)</span>，<span class="arithmatex">\(f_{j,k-1}+(s_i\oplus s_j)\bmod 2^8\)</span> 的最小值。这样枚举 <span class="arithmatex">\(y\)</span> 预处理，枚举 <span class="arithmatex">\(x\)</span> 计算 DP 值。</p>
<p>即在确定 <span class="arithmatex">\(s_j\)</span> 时，枚举 <span class="arithmatex">\(s_i\)</span> 所有后 <span class="arithmatex">\(8\)</span> 位的情况，算出当 <span class="arithmatex">\(s_i\)</span> 后 <span class="arithmatex">\(8\)</span> 位确定时后 <span class="arithmatex">\(8\)</span> 位的最小值，同时在状态中记录 <span class="arithmatex">\(s_j\)</span> 的前 <span class="arithmatex">\(8\)</span> 位供询问时确定 <span class="arithmatex">\(s_i\)</span> 的前 <span class="arithmatex">\(8\)</span> 位确定时计算。看代码就懂了。</p>
<p>时间复杂度 <span class="arithmatex">\(\mathcal O(nk\sqrt v)\)</span>。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="o">=</span><span class="mf">6e4</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span><span class="n">M</span><span class="o">=</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="n">M</span><span class="p">][</span><span class="n">M</span><span class="p">];</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kt">signed</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">        </span><span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">];</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">memset</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span><span class="n">k</span><span class="o">&lt;=</span><span class="n">m</span><span class="p">;</span><span class="n">k</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="n">memset</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">g</span><span class="p">));</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">k</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">s</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">);</span><span class="n">s</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">                </span><span class="n">g</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">][</span><span class="n">s</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">][</span><span class="n">s</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">][</span><span class="n">k</span><span class="mi">-1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">]</span><span class="o">^</span><span class="n">s</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">));</span><span class="w"> </span><span class="c1">//i-1 即在 i 前面的 j    </span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">            </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">s</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">);</span><span class="n">s</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">                </span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)]</span><span class="o">+</span><span class="p">(((</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">^</span><span class="n">s</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">));</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">m</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d &quot;</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">m</span><span class="p">]);</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="p">}</span>
</code></pre></div>
<h5 id="p6192">*P6192 【模板】最小斯坦纳树<a class="headerlink" href="#p6192" title="Permanent link">&para;</a></h5>
<blockquote>
<p>给出一张 <span class="arithmatex">\(n\)</span> 个点，<span class="arithmatex">\(m\)</span> 条有权边的无向连通图，其中有 <span class="arithmatex">\(k\)</span> 个点是关键点。求图的一个子图，满足包含了所有 <span class="arithmatex">\(k\)</span> 个关键点，使得所包含的边集的权值和最小，求这个最小值。</p>
<p><span class="arithmatex">\(n\le 100\)</span>，<span class="arithmatex">\(m\le500\)</span>，<span class="arithmatex">\(k\le10\)</span>。</p>
</blockquote>
<p>答案一定是一棵树，因为有环肯定不优。不妨钦定树根。设 <span class="arithmatex">\(f_{x,S}\)</span> 表示以 <span class="arithmatex">\(x\)</span> 为根的树，包含集合 <span class="arithmatex">\(S\)</span> 内的关键点的最小代价。</p>
<ul>
<li>合并两棵树：<span class="arithmatex">\(\min_{t\subseteq S}\{f_{x,t}+f_{x,s\backslash t}\}\to f_{i,s}\)</span>（由于权值在边上所以不会多算）。</li>
<li>换根：<span class="arithmatex">\(f_{y,S}+w_{x,y}\to f_{x,S}\)</span>。</li>
</ul>
<p>第一种转移 <span class="arithmatex">\(3^k\)</span> 枚举，第二种转移跑个最短路。</p>
<p>时间复杂度 <span class="arithmatex">\(\mathcal O(n3^k+m\log m2^k)\)</span>。</p>
<h5 id="at_apc001_f-xor-tree">*AT_apc001_f XOR Tree<a class="headerlink" href="#at_apc001_f-xor-tree" title="Permanent link">&para;</a></h5>
<p>边权化点权</p>
<blockquote>
<p>给出一棵 <span class="arithmatex">\(n\)</span> 个节点的树，边有边权。</p>
<p>每次操作可以将一条路径上的边权异或上某个值。问最少操作多少次能使边权全为 <span class="arithmatex">\(0\)</span>。</p>
<p><span class="arithmatex">\(2\leq n\leq 10^5\)</span>，<span class="arithmatex">\(0\leq w_i\leq 15\)</span>。</p>
</blockquote>
<p>一条路径上的边太多不好考虑。</p>
<p>一个巧妙的转化：定义一个点的点权为与其相邻的所有边的边权异或和。容易证明边权全为 <span class="arithmatex">\(0\)</span> 等价于点权全为 <span class="arithmatex">\(0\)</span>（必要性显然，充分性考虑从叶子往上推）。每次操作就是将任意两个点异或上同一个数。</p>
<p>操作 <span class="arithmatex">\(a,b\)</span> 时，若 <span class="arithmatex">\(a=b\)</span> 可以一次操作消去它们两个，若 <span class="arithmatex">\(a\neq b\)</span> 可以一次操作消去它们两个并留下 <span class="arithmatex">\(a\oplus b\)</span>。可以证明不会同时异或一个 <span class="arithmatex">\(\neq a\)</span> 也 <span class="arithmatex">\(\neq b\)</span> 的数。</p>
<p>由于只有 <span class="arithmatex">\(16\)</span> 种取值，先将重复的直接消去，剩下的信息只有 <span class="arithmatex">\(0\sim 15\)</span> 每种数字是否出现过，可以状压。</p>
<p>转移枚举要操作 <span class="arithmatex">\(a\neq b\)</span>，若 <span class="arithmatex">\(a\oplus b\notin S\)</span> 就 <span class="arithmatex">\(f_S\gets f_{S-\{a,b\}+\{a\oplus b\}}+1\)</span>，否则 <span class="arithmatex">\(f_S\gets f_{S-\{a,b\}}+2\)</span> 表示新增一次操作消掉 <span class="arithmatex">\(a\oplus b\)</span>。</p>
<p>注意转移顺序是按 <span class="arithmatex">\(|S|\)</span> 从小到大。</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["search", "content.action.edit", "navigation.tabs", "navigation.instant", "navigation.top", "content.code.copy", "search.suggest", "search.highlight", "search.share", "navigation.tracking"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
      
        <script src="../../../javascripts/katex.js"></script>
      
    
  </body>
</html>